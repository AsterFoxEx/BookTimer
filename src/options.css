    /* ===== Design tokens ===== */
    :root{
      /* Brand scale */
      --brand-50:#eff6ff; --brand-100:#dbeafe; --brand-200:#bfdbfe; --brand-300:#93c5fd;
      --brand-400:#60a5fa; --brand-500:#3b82f6; --brand-600:#2563eb; --brand-700:#1d4ed8;
      --brand-800:#1e40af; --brand-900:#1e3a8a;

      /* Status */
      --danger-500:#ef4444; --danger-600:#dc2626;

      /* Base (light) */
      --bg:#f8fafc; --bg-soft:#eef2f7; --surface:#ffffff; --surface-2:#fafafa;
      --text:#0f172a; --muted:#66738a; --border:#e5e7eb;

      /* Elevation */
      --shadow-tone: color-mix(in oklab, var(--text) 8%, transparent);
      --shadow-0: 0 0 1px color-mix(in oklab, var(--shadow-tone) 26%, transparent);
      --shadow-1: 0 1px 2px color-mix(in oklab, var(--shadow-tone) 45%, transparent);
      --shadow-2: 0 6px 18px color-mix(in oklab, var(--shadow-tone) 35%, transparent);

      /* Layout scales */
      --container-s: 760px; --container-m: 980px; --container-l: 1100px;
      --control-h: 44px; --control-px: 14px;

      /* Radius & spacing */
      --radius-s: 10px; --radius-m: 14px; --radius-l: 18px;
      --space-1: 4px; --space-2: 6px; --space-3: 10px; --space-4: 14px; --space-5: 18px; --space-6: 22px; --space-8: 30px;

      /* Typography */
      --font-xs: 13px; --font-s: 14px; --font-m: 16px; --font-l: 18px; --font-xl: 22px;

      /* Sheen */
      --sheen-surface: linear-gradient(180deg, color-mix(in oklab, var(--surface) 96%, transparent), var(--surface));
      --sheen-soft: linear-gradient(180deg, color-mix(in oklab, var(--surface-2) 90%, transparent), var(--surface-2));

      /* App metrics */
      --topbar-h: 64px;

      /* Content widths */
      --tab-label-ch: 14ch;
      --work-title-ch: 28ch;
      --work-title-ch-sm: 22ch;

      /* Panel rhythm */
      --panel-gap: 22px;
    }

    /* ===== Dark theme (auto) ===== */
    @media (prefers-color-scheme: dark){
      :root{
        --bg:#0b0f15; --bg-soft:#0c121a; --surface:#0f1722; --surface-2:#0c121a;
        --text:#e5e7eb; --muted:#9aa4b2; --border:#1f2b3a;

        --shadow-tone: color-mix(in oklab, #000 30%, var(--text) 12%);
        --shadow-0: 0 0 1px color-mix(in oklab, var(--shadow-tone) 30%, transparent);
        --shadow-1: 0 1px 2px color-mix(in oklab, var(--shadow-tone) 55%, transparent);
        --shadow-2: 0 6px 22px color-mix(in oklab, var(--shadow-tone) 40%, transparent);

        --sheen-surface: linear-gradient(180deg, color-mix(in oklab, var(--brand-800) 8%, var(--surface)), var(--surface));
        --sheen-soft: linear-gradient(180deg, color-mix(in oklab, var(--brand-700) 10%, var(--surface-2)), var(--surface-2));
      }
    }

    /* ===== Manual theme overrides ===== */
    html[data-theme="light"]{
      --bg:#f8fafc; --bg-soft:#eef2f7; --surface:#ffffff; --surface-2:#fafafa;
      --text:#0f172a; --muted:#66738a; --border:#e5e7eb;
      --sheen-surface: linear-gradient(180deg, color-mix(in oklab, var(--surface) 96%, transparent), var(--surface));
      --sheen-soft: linear-gradient(180deg, color-mix(in oklab, var(--surface-2) 90%, transparent), var(--surface-2));
    }
    html[data-theme="dark"]{
      --bg:#0b0f15; --bg-soft:#0c121a; --surface:#0f1722; --surface-2:#0c121a;
      --text:#e5e7eb; --muted:#9aa4b2; --border:#1f2b3a;
      --sheen-surface: linear-gradient(180deg, color-mix(in oklab, var(--brand-800) 8%, var(--surface)), var(--surface));
      --sheen-soft: linear-gradient(180deg, color-mix(in oklab, var(--brand-700) 10%, var(--surface-2)), var(--surface-2));
    }

    /* ===== Reset / base ===== */
    *{ box-sizing: border-box; }
    html, body{
      margin:0; padding:0; background: var(--bg); color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans JP", "メイリオ", Meiryo, "Helvetica Neue", Arial;
      font-size: var(--font-s); line-height: 1.6;
      scrollbar-width: thin;
      scrollbar-color: color-mix(in oklab, var(--muted) 35%, transparent) transparent;
      /* 横はみ出しの最終防波堤（Firefox対応） */
      overflow-x: clip;
    }
    /* 置換要素は横に広がらないように */
    img, svg, video, canvas, audio, iframe, embed, object{ max-width: 100%; height: auto; }
    progress{
      display: block;
      width: 100%;
      max-width: 100%;
      min-width: 0;
      height: 10px;
      box-sizing: border-box;
    }
    /* Firefox のprogress内部色（任意） */
    progress::-moz-progress-bar{
      background: linear-gradient(90deg, var(--brand-500), var(--brand-600));
    }

    :focus-visible{
      outline:none;
      box-shadow: 0 0 0 3px color-mix(in oklab, var(--brand-400) 55%, transparent),
                  0 0 0 7px color-mix(in oklab, var(--brand-400) 18%, transparent);
      border-radius: 12px;
    }
    button:focus-visible,
    .card:focus-visible,
    .tab:focus-visible {
      outline: none;
      box-shadow:
        0 0 0 3px color-mix(in oklab, var(--brand-400) 55%, transparent),
        0 0 0 7px color-mix(in oklab, var(--brand-400) 18%, transparent);
      border-radius: 12px;
    }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; font-variant-numeric: tabular-nums; }
    .hidden{ display: none !important; }
    .truncate-1{ display:block; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; min-width:0; }
    .truncate-2{ display:block; overflow:hidden; line-height: 1.3; max-height: calc(1.3em * 2); }

    /* 縦はみ出しの防止: flex/grid 子要素を縮退可能に */
    .container, .views, .panel, .grid, .cards, .bars, .table-wrap, .lib-summary, .work-page-stats, .actions, .toolbar { min-width: 0; }
    .actions > *, .lib-summary > *, .work-page-stats > *, .toolbar > * { min-width: 0; }

    /* ===== Container ===== */
    .container{ width: 100%; margin-inline: auto; padding-inline: var(--space-5); max-width: var(--container-m); }
    @media (min-width: 1320px){ .container{ max-width: var(--container-l); } }
    @media (max-width: 840px){ .container{ max-width: var(--container-s); padding-inline: var(--space-4); } }

    /* ===== Topbar ===== */
    .topbar{
      position: sticky; top: 0; z-index: 40;
      background: var(--sheen-surface);
      border-bottom: 1px solid var(--border);
      backdrop-filter: saturate(1.05) blur(8px);
    }
    .appbar{
      min-height: var(--topbar-h);
      display:grid; gap: var(--space-3);
      grid-template-columns: 1fr;
      grid-template-areas: "brand" "tabs";
      align-items:center; padding-block: var(--space-3);
    }
    @media (min-width: 840px){
      .appbar{ grid-template-columns: auto 1fr; grid-template-areas: "brand tabs"; gap: var(--space-4); }
    }
    .brand{
      grid-area: brand; display:flex; align-items:center; gap: var(--space-3);
      font-weight: 800; letter-spacing:.2px; font-size: var(--font-l); white-space: nowrap; min-width: 0;
    }
    .brand .logo{
      inline-size: 28px; block-size: 28px; border-radius: 10px;
      background: linear-gradient(135deg, var(--brand-500), var(--brand-700));
      display:grid; place-items:center; color: white; box-shadow: var(--shadow-2);
      font-weight: 900; font-size: 14px;
    }

    /* ===== Toolbar ===== */
    .toolbar{
      grid-area: tabs;
      display:flex; gap: var(--space-2); overflow-x:auto;
      padding:6px; border:1px solid var(--border);
      background: color-mix(in oklab, var(--surface) 88%, transparent);
      border-radius: 14px; box-shadow: var(--shadow-0); min-width: 0;
      overscroll-behavior-x: contain;
    }
    .toolbar .tab{
      --bg-tab: transparent; --fg-tab: var(--muted);
      display:inline-flex; align-items:center; justify-content:center; gap: 8px; padding: 10px 14px;
      border-radius: 12px; border: 1px solid transparent; background: var(--bg-tab); color: var(--fg-tab);
      cursor:pointer; user-select:none;
      transition: background .2s ease, color .2s ease, border-color .2s ease, transform .08s ease;
      white-space: nowrap; flex: 0 0 auto; max-width: 100%;
    }
    .tab .icon{ inline-size: 18px; block-size: 18px; color: inherit; fill: currentColor; }
    .tab .label{ font-weight: 700; max-width: var(--tab-label-ch); }
    .toolbar .tab:hover{ background: color-mix(in oklab, var(--brand-100) 35%, transparent); color: var(--text); }
    .toolbar .tab:active{ transform: translateY(1px); }
    .toolbar .tab.active, .toolbar .tab[aria-selected="true"]{
      border-color: color-mix(in oklab, var(--brand-300) 55%, transparent);
      color: color-mix(in oklab, var(--brand-800) 80%, var(--text));
      background: linear-gradient(180deg, color-mix(in oklab, var(--brand-100) 75%, transparent), transparent);
      box-shadow: inset 0 0 0 1px color-mix(in oklab, var(--brand-300) 32%, transparent);
    }
    @media (max-width: 599px){
      .toolbar{ justify-content: space-between; }
      .toolbar .tab{ padding:0; width:54px; height:54px; border-radius:12px; }
      .toolbar .tab .label{ display:none; }
      .tab .icon{ inline-size:24px; block-size:24px; }
    }
    html[data-theme="dark"] .toolbar{
      background: color-mix(in oklab, var(--brand-900) 8%, var(--surface));
      border-color: color-mix(in oklab, var(--brand-700) 25%, var(--border));
    }
    html[data-theme="dark"] .toolbar .tab.active,
    html[data-theme="dark"] .toolbar .tab[aria-selected="true"]{
      color: color-mix(in oklab, var(--brand-50) 85%, var(--text));
      background: linear-gradient(180deg, color-mix(in oklab, var(--brand-500) 24%, transparent), transparent);
      box-shadow: inset 0 0 0 1px color-mix(in oklab, var(--brand-500) 35%, transparent);
    }

    /* ===== Main / panels ===== */
    .main{ padding-block: var(--space-5); }
    .views{ display:grid; gap: var(--space-5); overflow-x: clip; }

    .panel{
      background: var(--sheen-surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-l);
      padding: var(--space-5);
      box-shadow: var(--shadow-1);
      display:flex; flex-direction:column; gap: var(--space-4);
      min-width: 0;
    }
    .panel + .panel{ margin-top: var(--panel-gap); }

    .panel h2{ margin:0; font-size: clamp(16px, 1.6vw, var(--font-l)); display:flex; align-items:center; gap: 10px; min-width: 0; }
    .panel h2 .chip{
      font-size: var(--font-xs); padding: 2px 8px; border-radius: 999px;
      background: color-mix(in oklab, var(--brand-100) 60%, transparent);
      color: var(--brand-700);
      border: 1px solid color-mix(in oklab, var(--brand-200) 50%, transparent);
    }
    html[data-theme="dark"] .panel h2 .chip{
      background: color-mix(in oklab, var(--brand-700) 22%, transparent);
      color: color-mix(in oklab, var(--brand-50) 90%, var(--text));
      border-color: color-mix(in oklab, var(--brand-500) 35%, var(--border));
    }

    /* ===== Home layout ===== */
    .home-grid{
      display:grid; gap: var(--space-5); grid-template-columns: 1fr; align-items:start; min-width: 0;
      margin-bottom: var(--panel-gap);
    }
    .home-panel{ display:flex; flex-direction:column; }

    @media (min-width: 960px){
      #view-home .home-grid{
        display: flex; gap: var(--space-5);
        align-items: stretch;
        margin-bottom: var(--panel-gap);
      }
      #view-home .home-grid > .panel{
        flex: 1 1 0;
        display: flex;
        flex-direction: column;
        min-height: 100%;
      }
    }
    #view-home .home-grid .panel + .panel{ margin-top: 0; }
    #view-home .home-panel:first-child,
    #view-home .home-panel:nth-child(2){ gap: var(--space-3); }
    #view-home .home-panel:first-child h2{ margin-bottom: 2px; }
    #view-home .home-panel:first-child .stats{ gap: var(--space-3); }
    #view-home .home-panel:first-child .stat{ padding-block: 8px; }
    #view-home .home-panel:first-child .stat .label{ line-height: 1.3; }
    #view-home .home-panel:first-child .stat .value{
      font-size: clamp(18px, 1.8vw, var(--font-xl));
      line-height: 1.3;
    }

    /* ===== Stats blocks ===== */
    .stats{ display:grid; gap: var(--space-3); }
    .stat{
      display:flex; justify-content:space-between; align-items:center; gap: var(--space-3);
      padding: 10px; border-radius: var(--radius-m);
      background: var(--sheen-soft); border: 1px solid var(--border);
      box-shadow: var(--shadow-0);
      min-width: 0;
    }
    .stat .label{ color: var(--muted); font-weight: 700; min-width: 0; }
    .stat .value{ font-weight: 900; font-size: clamp(18px, 1.6vw, var(--font-xl)); min-width: 0; }
    .stat-primary .value{ color: var(--brand-700); }

    /* ===== Controls ===== */
    .actions{ display:flex; flex-wrap:wrap; gap: var(--space-3); align-items:center; min-width: 0; }
    .actions-bar{ background: var(--sheen-soft); padding: var(--space-3); border-radius: var(--radius-m); box-shadow: var(--shadow-0); }
    .actions-right{ justify-content: flex-end; }
    .input, select{
      height: var(--control-h);
      padding: 0 var(--control-px);
      border: 1px solid var(--border);
      border-radius: var(--radius-s);
      background: var(--surface); color: var(--text);
      font-size: var(--font-m);
      box-shadow: 0 1px 0 color-mix(in oklab, var(--shadow-tone) 30%, transparent) inset;
      accent-color: var(--brand-600);
      min-width: 180px;
    }
    .input{ width: clamp(180px, 30vw, 360px); min-width: 0; }
    select{
      padding-right: calc(var(--control-px) + 18px);
      background-image: linear-gradient(45deg, transparent 50%, var(--muted) 50%), linear-gradient(135deg, var(--muted) 50%, transparent 50%);
      background-position: calc(100% - 18px) calc(50% - 2px), calc(100% - 12px) calc(50% - 2px);
      background-size: 6px 6px, 6px 6px; background-repeat: no-repeat;
    }

    /* ===== Buttons ===== */
    button, .btn{
      height: var(--control-h);
      padding: 0 var(--control-px);
      font-size: var(--font-m); font-weight: 800;
      border-radius: var(--radius-s);
      border: 1px solid var(--border);
      cursor:pointer; background: var(--surface); color: var(--text);
      box-shadow: var(--shadow-1);
      transition: transform .08s, background .2s, border-color .2s, color .2s, box-shadow .2s;
      min-width: 0; max-width: 100%;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
      flex: 1 1 auto;
    }
    button:hover{ background: color-mix(in oklab, var(--bg-soft) 55%, transparent); }
    button:active{ transform: translateY(1px); }
    button.secondary{
      background: color-mix(in oklab, var(--brand-50) 58%, var(--surface));
      color: var(--brand-800);
      border-color: color-mix(in oklab, var(--brand-200) 45%, transparent);
    }
    html[data-theme="dark"] button.secondary{
      background: color-mix(in oklab, var(--surface-2) 90%, var(--brand-800) 8%);
      color: color-mix(in oklab, var(--brand-50) 85%, var(--text));
      border-color: color-mix(in oklab, var(--brand-600) 26%, var(--border));
    }
    button.primary{ background: linear-gradient(180deg, var(--brand-500), var(--brand-600)); color:#fff; border-color: var(--brand-600); box-shadow: var(--shadow-2); }
    button.danger{ background: linear-gradient(180deg, var(--danger-500), var(--danger-600)); color:#fff; border-color: var(--danger-600); box-shadow: var(--shadow-2); }
    button.ghost{ background: var(--surface-2); color: var(--muted); border: 1px dashed var(--border); box-shadow: none; }
    button.small{ height: 40px; font-weight: 700; }

    /* ===== Grids / cards ===== */
    .grid{ display:grid; gap: var(--space-4); grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); min-width: 0; }
    .cards{ display:grid; gap: var(--space-4); grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); min-width: 0; }
    .card{
      background: var(--sheen-surface); border: 1px solid var(--border); border-radius: var(--radius-m);
      padding: var(--space-4); display:grid; gap: var(--space-3);
      transition: transform .08s, box-shadow .2s, border-color .2s;
      box-shadow: var(--shadow-1); min-width: 0;
    }
    .card:hover{ transform: translateY(-1px); box-shadow: var(--shadow-2); border-color: color-mix(in oklab, var(--brand-200) 55%, transparent); }
    .card .title{ font-weight: 800; min-width: 0; }
    .card .meta{ color: var(--muted); font-size: var(--font-xs); min-width: 0; }

    /* ===== Recent works ===== */
    .grid-works{
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--space-4);
      align-items: stretch;
      min-width: 0;
    }
    @media (max-width: 599px){
      .grid-works{ grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); }
    }
    #recentWorks .card{ display:flex; flex-direction: column; gap: var(--space-3); }
    #recentWorks .card .title .text{
      display:block; max-width: var(--work-title-ch);
      line-height: 1.3; max-height: calc(1.3em * 2); overflow:hidden;
    }
    @media (max-width: 599px){
      #recentWorks .card .title .text{ max-width: var(--work-title-ch-sm); }
      #recentWorks .card .meta{ display: none; }
    }
    #recentWorks .card .actions{
      margin-top: auto;
      display:flex; flex-wrap: wrap; gap: var(--space-2);
    }
    #recentWorks .card .actions button{
      flex: 0 1 auto;
      min-width: 0; max-width: 100%;
      min-height: 40px;
    }
    @media (max-width: 599px){
      #recentWorks .card .actions button{ flex: 1 1 100%; }
      #recentWorks .card .actions{ gap: var(--space-3); }
    }

    /* ===== Library shelf ===== */
    .shelf details{
      border: 1px solid var(--border); border-radius: var(--radius-m); padding: var(--space-4);
      background: var(--sheen-surface); margin-bottom: var(--space-4);
      transition: border-color .2s, box-shadow .2s, background .2s; box-shadow: var(--shadow-1); min-width: 0;
    }
    .shelf details[open]{
      border-color: color-mix(in oklab, var(--brand-200) 55%, transparent);
      box-shadow: var(--shadow-2);
      background: var(--sheen-surface);
    }
    summary{ list-style: none; }
    summary::-moz-list-bullet{ list-style-type: none; }

    .lib-summary{
      display:grid;
      grid-template-columns: 1fr auto; /* Title / Actions */
      gap: var(--space-3);
      align-items:start;
      min-width: 0;
    }
    .lib-title{
      font-weight: 800;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      line-height: 1.3;
      max-height: calc(1.3em * 2);
      min-width: 0;
    }
    .lib-meta{
      grid-column: 1 / -1;
      display: grid;
      grid-auto-flow: column;
      gap: var(--space-3);
      align-items: center;
      font-size: var(--font-xs); color: var(--muted);
      min-width: 0;
    }
    .lib-meta .meta-item{
      display:inline-flex; align-items:center; gap: 6px; min-width: 0;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .lib-meta .label{ font-weight: 700; color: var(--muted); }
    .lib-meta .value{ white-space: nowrap; overflow: hidden; text-overflow: ellipsis; min-width: 0; }
    .lib-meta .icon{ opacity: .75; font-size: 0.95em; }
    .lib-actions{
      display:flex; flex-wrap: wrap; gap: var(--space-2);
      justify-content: flex-end;
      min-width: 0;
    }
    .lib-actions button{ flex: 0 1 auto; min-width: 0; max-width: 100%; }

    @media (max-width: 599px){
      .lib-summary{ grid-template-columns: 1fr; gap: var(--space-3); }
      .lib-meta{ grid-auto-flow: row; grid-template-columns: 1fr; gap: 4px; }

      .lib-title{
        display:block;
        white-space: normal;
        overflow-wrap: anywhere;
        text-overflow: clip;
        max-height: none;
      }
      .lib-meta .meta-item,
      .lib-meta .value{
        white-space: normal;
        overflow-wrap: anywhere;
        text-overflow: clip;
      }
      .lib-actions button{ flex: 1 1 100%; }
    }

    /* ===== Work page ===== */
    #view-work .work-summary {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: var(--space-3);
      align-items: start;
      min-width: 0;
    }
    #view-work .work-header {
      display: grid;
      grid-auto-flow: row;
      gap: 6px;
      min-width: 0;
    }
    #view-work .work-title,
    #view-work .work-meta {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      min-width: 0;
    }
    #view-work .work-page-stats{ display:grid; grid-auto-flow: row; gap: var(--space-3); min-width: 0; }
    @media (min-width: 640px){ #view-work .work-page-stats{ grid-auto-flow: column; justify-content: start; } }
    #workEpisodes.episodes{ display:grid; gap: var(--space-3); min-width: 0; }
    #workEpisodes .episode{
      display:grid; grid-template-columns: 1fr auto auto; align-items:center; gap: var(--space-3);
      padding: 10px 12px; border: 1px dashed var(--border); border-radius: var(--radius-m);
      background: var(--sheen-soft); box-shadow: var(--shadow-1); min-width: 0;
    }
    #workInnerStats.cards{ display:grid; grid-template-columns: 1fr; gap: var(--space-4); min-width: 0; }
    @media (min-width:820px){ #workInnerStats.cards{ grid-template-columns: repeat(3, minmax(0, 1fr)); } }
    .cards .meta{ color: var(--brand-700); font-weight: 800; }
    html[data-theme="dark"] .cards .meta{ color: color-mix(in oklab, var(--brand-50) 85%, var(--text)); }

    /* 省略/折返しの一貫化（episodeリンク） */
    #workEpisodes .episode a {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      min-width: 0;
    }
    @media (max-width: 599px) {
      #workEpisodes .episode a {
        white-space: normal;
        overflow-wrap: anywhere;
        text-overflow: clip;
      }
    }

    /* スマホ: 完全縦並び */
    @media (max-width: 599px){
      #view-work .work-summary { grid-template-columns: 1fr; gap: var(--space-3); }
      #view-work .work-header { gap: 4px; }
      #view-work .work-title { white-space: normal; overflow-wrap: anywhere; text-overflow: clip; }
      #view-work .work-meta {
        display: grid; grid-auto-flow: row; grid-template-columns: 1fr; gap: 4px;
      }
      #view-work .work-meta .meta-item,
      #view-work .work-meta .value { white-space: normal; overflow-wrap: anywhere; text-overflow: clip; }
      #view-work .work-actions { display: grid; grid-template-columns: 1fr; gap: var(--space-2); }
      #view-work .work-actions button { flex: 1 1 100%; }
    }
/* スマホ専用調整 */
@media (max-width: 599px) {
  /* テーブルセルは折り返し優先 */
  #tableDetails td,
  #tableAggWork td,
  #tableAggEpisode td {
    max-width: none !important;
    white-space: normal !important;
    overflow-wrap: anywhere;
    text-overflow: clip;
  }

  /* data-label と値を縦に並べて見やすく */
  .table-wrap tbody td {
    grid-template-columns: 1fr; /* ラベルと値を縦積み */
    gap: 2px;
  }
  .table-wrap tbody td::before {
    font-size: var(--font-xs);
    margin-bottom: 2px;
    color: var(--muted);
  }

  /* 日別ログのバーも詰まりすぎないように */
  .bars {
    grid-auto-rows: auto;
    gap: var(--space-2);
  }
  .bar {
    grid-template-columns: 1fr; /* ラベル・ゲージ・値を縦積み */
    gap: 4px;
  }
  .bar .label,
  .bar .value {
    text-align: left;
    font-size: var(--font-s);
  }
  .bar .gauge {
    height: 12px;
  }
}


    /* ===== Bars (daily) ===== */
    .bars{ display:grid; grid-auto-rows: 28px; gap: var(--space-3); min-width: 0; }
    .bar{ display:grid; grid-template-columns: 72px 1fr 88px; align-items:center; gap: var(--space-3); min-width: 0; }
    .bar .label{ color: var(--muted); font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .bar .gauge{
      height: 14px; background: linear-gradient(180deg, color-mix(in oklab, var(--brand-100) 64%, transparent), transparent);
      border-radius: 999px; overflow: hidden; position: relative; border: 1px solid color-mix(in oklab, var(--brand-200) 60%, transparent);
      box-shadow: var(--shadow-1);
      min-width: 0;
    }
    .bar .fill{
      height:100%; background: linear-gradient(90deg, var(--brand-500), var(--brand-600));
      transform-origin: left center; transform: scaleX(0);
      transition: transform .4s cubic-bezier(.22,1,.36,1);
    }
    .bar .value{
      text-align: right; font-variant-numeric: tabular-nums; font-weight: 800; color: var(--brand-700); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    html[data-theme="dark"] .bar .label{ color: color-mix(in oklab, var(--brand-50) 70%, var(--muted)); }
    html[data-theme="dark"] .bar .value{ color: color-mix(in oklab, var(--brand-50) 85%, var(--text)); }

    /* ===== Tables ===== */
    .table-wrap{
      overflow: auto; /* コンテンツはこの中でのみ横スクロール */
      overflow-x: auto;
    
      contain: inline-size; /* stickyヘッダの描画を隔離（Firefoxでのはみ出し軽減） */
      border-radius: var(--radius-m);
      border: 1px solid var(--border);
      background: var(--surface);
      box-shadow: var(--shadow-1);
      min-width: 0;
      max-width: 100%;
    }
    .table{ width: 100%; border-collapse: collapse; font-size: var(--font-s); }
    .table-fixed{ table-layout: fixed; }
    thead th{
      position: sticky; top: 0;
      background: linear-gradient(180deg, color-mix(in oklab, var(--surface) 88%, transparent), color-mix(in oklab, var(--surface) 94%, transparent));
      color: var(--muted);
      font-weight: 800; padding: 10px; border-bottom: 1px solid var(--border); text-align: center; z-index: 1;
      box-shadow: inset 0 -1px 0 color-mix(in oklab, var(--shadow-tone) 28%, transparent);
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    tbody td{
      padding: 10px; border-bottom: 1px solid var(--border); text-align: center;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
      min-width: 0;
    }
    /* タイトル列はデスクトップでは省略表示（横押し広げ回避） */
    #tableDetails td:nth-child(3),
    #tableAggWork td:nth-child(2),
    #tableAggEpisode td:first-child{
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 0; /* セル幅に従わせるテクニック */
    }
    /* details/summaryの縮退許可 */
    #tableAggEpisode details,
    #tableAggEpisode summary{ min-width: 0; }
    #tableAggEpisode summary{ display:flex; align-items: baseline; gap: 6px; }
    /* table内のprogressは必ずセル内に収める */
    .table-wrap progress{ width: 100%; max-width: 100%; min-width: 0; }

    tbody tr:hover{
      background: linear-gradient(180deg, color-mix(in oklab, var(--brand-50) 55%, transparent), transparent);
      box-shadow: inset 0 1px 0 color-mix(in oklab, var(--brand-200) 35%, transparent);
    }
    html[data-theme="dark"] tbody tr:hover{
      background: linear-gradient(180deg, color-mix(in oklab, var(--brand-800) 18%, transparent), transparent);
      box-shadow: inset 0 1px 0 color-mix(in oklab, var(--brand-600) 26%, transparent);
    }
    #tableDetails td:nth-child(3),
    #tableAggWork td:nth-child(2),
    #tableAggEpisode td:first-child{
      text-align: left; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    @media (max-width: 599px){
      #tableDetails th:nth-child(6), #tableDetails td:nth-child(6),
      #tableDetails th:nth-child(7), #tableDetails td:nth-child(7){ display: none; }
    }

    /* タイトル省略（統計→エピソード別） */
    #tableAggEpisode details{ display:block; min-width:0; }
    #tableAggEpisode details > summary{
      display: grid;
      grid-auto-flow: row;
      gap: 4px;
      min-width: 0;
    }
    #tableAggEpisode details > summary .ep-title{
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      min-width: 0;
      font-weight: 800;
    }

    /* ===== Toast / Empty ===== */
    .toast{
      position: fixed; left: 50%; transform: translateX(-50%) translateY(10px);
      bottom: var(--space-5);
      background: var(--sheen-surface); color: var(--text);
      border: 1px solid var(--border); border-radius: var(--radius-m); padding: 10px 14px;
      box-shadow: var(--shadow-2); opacity: 0; pointer-events: none; transition: opacity .2s, transform .2s; z-index: 70;
      max-width: min(640px, 90vw);
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .toast.show{ opacity: 1; transform: translateX(-50%) translateY(0); pointer-events: auto; }
    .toast.success { border-color: color-mix(in oklab, var(--brand-300) 60%, transparent); box-shadow: var(--shadow-2); }
    .toast.warn { border-color: color-mix(in oklab, #f59e0b 40%, var(--border)); box-shadow: var(--shadow-2); }
    .toast.error { border-color: color-mix(in oklab, var(--danger-600) 60%, var(--border)); box-shadow: var(--shadow-2); }

    .empty{
      padding: 24px; border: 1px dashed var(--border);
      border-radius: var(--radius-m); text-align: center; color: var(--muted); background: var(--surface-2);
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }

    /* ===== Motion respect ===== */
    @media (prefers-reduced-motion: reduce){
      *{ transition: none !important; animation: none !important; }
      #view-home .home-panel:first-child .stat .value{ transition: none !important; }
    }

    /* ===== Mobile card tables ===== */
    @media (max-width: 599px){
      .table-wrap {
        border-radius: var(--radius-m);
        background: var(--sheen-surface);
        box-shadow: var(--shadow-1);
        padding: var(--space-3);
      }
      .table-wrap table,
      .table-wrap thead,
      .table-wrap tbody,
      .table-wrap tr,
      .table-wrap th,
      .table-wrap td {
        display: block; width: 100%;
      }
      .table-wrap thead { display: none; }
      .table-wrap tbody tr {
        margin-bottom: var(--space-4);
        border: 1px solid var(--border);
        border-radius: var(--radius-m);
        padding: var(--space-4);
        background: var(--sheen-surface);
        box-shadow: var(--shadow-1);
      }
      .table-wrap tbody td {
        display: grid;
        grid-template-columns: auto 1fr;
        align-items: baseline;
        gap: var(--space-3);
        padding: 6px 0;
        border: none;
        text-align: left;
        white-space: normal;
        overflow-wrap: anywhere;
        text-overflow: clip;
        min-width: 0;
      }
      .table-wrap tbody td::before {
        content: attr(data-label);
        color: var(--muted);
        font-weight: 700;
      }
      .table-wrap tbody tr:hover {
        background: var(--sheen-surface);
        box-shadow: var(--shadow-1);
      }
      /* 並び最適化 */
      #tableDetails tbody td:nth-child(1){ order: 1; } /* 日付 */
      #tableDetails tbody td:nth-child(3){ order: 2; } /* 作品 */
      #tableDetails tbody td:nth-child(2){ order: 3; } /* サイト */
      #tableDetails tbody td:nth-child(4){ order: 4; } /* 話数 */
      #tableDetails tbody td:nth-child(5){ order: 5; } /* 時間 */
      #tableDetails tbody td:nth-child(6){ order: 6; } /* 時刻 */
      #tableDetails tbody td:nth-child(7){ order: 7; } /* セッション */

      #tableAggWork tbody td:nth-child(2){ order: 1; } /* 作品 */
      #tableAggWork tbody td:nth-child(3){ order: 2; } /* 合計時間 */
      #tableAggWork tbody td:nth-child(1){ order: 3; } /* サイト */

      #tableAggEpisode tbody td:nth-child(1){ order: 1; } /* 作品 */
      #tableAggEpisode tbody td:nth-child(2){ order: 2; } /* 話数 */
      #tableAggEpisode tbody td:nth-child(3){ order: 3; } /* セッション合計 */
    }

    /* ライブラリアクションの外観 */
    .lib-actions button {
      background: var(--surface-2);
      color: var(--muted);
      border: 1px solid var(--border);
      box-shadow: none;
    }
    .lib-actions button.open-work {
      background: var(--surface);
      color: var(--brand-700);
      border: 1px solid var(--brand-200);
    }